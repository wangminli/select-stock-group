"""
é‚¢ä¸è¡Œâ„¢ï¸é€‰è‚¡æ¡†æž¶
Pythonè‚¡ç¥¨é‡åŒ–æŠ•èµ„è¯¾ç¨‹

ç‰ˆæƒæ‰€æœ‰ Â©ï¸ é‚¢ä¸è¡Œ
å¾®ä¿¡: xbx8662

æœªç»æŽˆæƒï¼Œä¸å¾—å¤åˆ¶ã€ä¿®æ”¹ã€æˆ–ä½¿ç”¨æœ¬ä»£ç çš„å…¨éƒ¨æˆ–éƒ¨åˆ†å†…å®¹ã€‚ä»…é™ä¸ªäººå­¦ä¹ ç”¨é€”ï¼Œç¦æ­¢å•†ä¸šç”¨é€”ã€‚

Author: é‚¢ä¸è¡Œ
"""
import os
from pathlib import Path

# ====================================================================================================
# 1ï¸âƒ£ å›žæµ‹é…ç½®
# ====================================================================================================
# å›žæµ‹æ•°æ®çš„èµ·å§‹æ—¶é—´ã€‚å¦‚æžœå› å­ä½¿ç”¨æ»šåŠ¨è®¡ç®—æ–¹æ³•ï¼Œåœ¨å›žæµ‹åˆæœŸå› å­å€¼å¯èƒ½ä¸º NaNï¼Œå®žé™…çš„é¦–æ¬¡äº¤æ˜“æ—¥æœŸå¯èƒ½æ™šäºŽè¿™ä¸ªèµ·å§‹æ—¶é—´ã€‚
start_date = "2014-01-01"
# å›žæµ‹æ•°æ®çš„ç»“æŸæ—¶é—´ã€‚å¯ä»¥è®¾ä¸º Noneï¼Œè¡¨ç¤ºä½¿ç”¨æœ€æ–°æ•°æ®ï¼›ä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“æ—¥æœŸï¼Œä¾‹å¦‚ '2024-11-01'ã€‚
end_date = None

# ====================================================================================================
# 2ï¸âƒ£ æ•°æ®é…ç½®
# ====================================================================================================
# æ•°æ®ä¸­å¿ƒçš„æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨æ•°æ®å®¢æˆ·ç«¯ï¼Œå¹¶è®¢é˜…ç›¸å…³æ•°æ®ï¼Œå°±ä¸éœ€è¦å†æ‰‹åŠ¨æŒ‡å®šæ¯ä¸€ä¸ªå¿…è¦æ•°æ®
data_center_path = Path(r"/Users/wangminli/æˆ‘çš„æ–‡æ¡£/Quant/é‚¢ä¸è¡Œé‡åŒ–è¯¾ç¨‹-ä»˜è´¹/ä¸‹è½½æ•°æ®")

# æ•°æ®æºçš„å®šä¹‰ï¼Œå¦‚æžœä¸ä½¿ç”¨æ•°æ®å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨è‡ªå®šä¹‰ä»¥ä¸‹é€ä¸ªæ•°æ®æº
# ** è‚¡ç¥¨æ—¥çº¿æ•°æ® å’Œ æŒ‡æ•°æ•°æ®æ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–çš„æ•°æ®å¯ä»¥åœ¨ data_sources ä¸­å®šä¹‰ **
# (å¿…é€‰) è‚¡ç¥¨æ—¥çº¿æ•°æ®ï¼Œå…¨é‡æ•°æ®ä¸‹è½½é“¾æŽ¥ï¼šhttps://www.quantclass.cn/data/stock/stock-trading-data
# å‚è€ƒï¼šhttps://bbs.quantclass.cn/thread/39599
# (å¿…é€‰) è‚¡ç¥¨æ—¥çº¿æ•°æ®ï¼Œå…¨é‡æ•°æ®ä¸‹è½½é“¾æŽ¥ï¼šhttps://www.quantclass.cn/data/stock/stock-trading-data
stock_data_path = r"/Users/wangminli/æˆ‘çš„æ–‡æ¡£/Quant/é‚¢ä¸è¡Œé‡åŒ–è¯¾ç¨‹-ä»˜è´¹/ä¸‹è½½æ•°æ®/stock-trading-data-pro"  # å‚è€ƒï¼šhttps://bbs.quantclass.cn/thread/39599
# (å¿…é€‰) æŒ‡æ•°æ•°æ®è·¯å¾„ï¼Œå…¨é‡æ•°æ®ä¸‹è½½é“¾æŽ¥ï¼šhttps://www.quantclass.cn/data/stock/stock-main-index-data
index_data_path = r"/Users/wangminli/æˆ‘çš„æ–‡æ¡£/Quant/é‚¢ä¸è¡Œé‡åŒ–è¯¾ç¨‹-ä»˜è´¹/ä¸‹è½½æ•°æ®/stock-main-index-data"
# (å¯é€‰) è´¢åŠ¡æ•°æ®ï¼Œå…¨é‡æ•°æ®ä¸‹è½½é“¾æŽ¥ï¼šhttps://www.quantclass.cn/data/stock/stock-fin-data-xbx
fin_data_path = r"/Users/wangminli/æˆ‘çš„æ–‡æ¡£/Quant/é‚¢ä¸è¡Œé‡åŒ–è¯¾ç¨‹-ä»˜è´¹/ä¸‹è½½æ•°æ®/stock-fin-data-xbx"


# ====================================================================================================
# 3ï¸âƒ£ ç­–ç•¥é…ç½®
# ====================================================================================================
# ç­–ç•¥æ˜Žç»†
strategy = {
    'name': 'æˆäº¤é¢ç¼©æ³¢ç­–ç•¥',  # ç­–ç•¥å
    'hold_period': '3D',  # æŒä»“å‘¨æœŸï¼ŒW ä»£è¡¨å‘¨ï¼ŒM ä»£è¡¨æœˆï¼Œè¿˜æ”¯æŒæ—¥é¢‘ï¼š3Dã€5Dã€10D
    'select_num': 5,  # é€‰è‚¡æ•°é‡ï¼Œå¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å°æ•°ï¼Œæ¯”å¦‚ 0.1 è¡¨ç¤ºé€‰å– 10% çš„è‚¡ç¥¨
    "factor_list": [  # é€‰è‚¡å› å­åˆ—è¡¨
        ('Ret', True, 5, 1),
        ('å¸‚å€¼', True, '', 1),
        ('æˆäº¤é¢ç¼©æ³¢å› å­', True, (10, 60), 1),
        # å¯æ·»åŠ å¤šä¸ªé€‰è‚¡å› å­
    ],
    "filter_list": [
        # **å› å­è¿‡æ»¤è§„åˆ™è¯´æ˜Ž **
        ('æ”¶ç›˜ä»·', None, 'val:>1.5', True),
        ('å¸‚å€¼', None, 'val:<=3e9', False),
        ('æœˆä»½', [1,4], 'val:!=1', False),
    ]  # è¿‡æ»¤å› å­åˆ—è¡¨
}

days_listed = 250  # ä¸Šå¸‚è‡³ä»Šäº¤æ˜“å¤©æ•°

excluded_boards = ["bj"]  # è¿‡æ»¤æ¿å—ï¼Œé»˜è®¤ä¸è¿‡æ»¤
# excluded_boards = ["cyb", "kcb", "bj"]  # åŒæ—¶è¿‡æ»¤åˆ›ä¸šæ¿å’Œç§‘åˆ›æ¿å’ŒåŒ—äº¤æ‰€

# ðŸ’¡è¿è¡Œæç¤ºï¼š
# - ä¿®æ”¹hold_periodä¹‹åŽï¼Œéœ€è¦æ‰§è¡Œstep2å› å­è®¡ç®—ï¼Œä¸éœ€è¦å†æ¬¡å‡†å¤‡æ•°æ®
# - ä¿®æ”¹select_numä¹‹åŽï¼Œåªéœ€è¦å†æ‰§è¡Œstep3é€‰è‚¡å³å¯ï¼Œä¸éœ€è¦å‡†å¤‡æ•°æ®å’Œè®¡ç®—å› å­
# - ä¿®æ”¹factor_listä¹‹åŽï¼Œéœ€è¦æ‰§è¡Œstep2å› å­è®¡ç®—ï¼Œä¸éœ€è¦å†æ¬¡å‡†å¤‡æ•°æ®
# - ä¿®æ”¹filter_listä¹‹åŽï¼Œéœ€è¦æ‰§è¡Œstep2å› å­è®¡ç®—ï¼Œä¸éœ€è¦å†æ¬¡å‡†å¤‡æ•°æ®

# èµ„é‡‘æ›²çº¿å†æ‹©æ—¶é…ç½®ï¼ˆéžå¿…è¦ï¼Œå¯ä»¥ä¸ºç©ºï¼‰
# ç”¨äºŽåœ¨å›žæµ‹å®ŒæˆåŽï¼Œå¯¹èµ„é‡‘æ›²çº¿è¿›è¡ŒäºŒæ¬¡æ‹©æ—¶ï¼Œç”ŸæˆåŠ¨æ€æ æ†
# å¯ä»¥å‚è€ƒçš„æ‹©æ—¶æ–¹æ³•ï¼š
#   - ç§»åŠ¨å¹³å‡çº¿ï¼šæ ¹æ®èµ„é‡‘æ›²çº¿ä¸Žç§»åŠ¨å¹³å‡çº¿çš„å…³ç³»è¿›è¡Œæ‹©æ—¶
#   - å¸ƒæž—å¸¦ï¼šæ ¹æ®èµ„é‡‘æ›²çº¿ä¸Žå¸ƒæž—å¸¦çš„å…³ç³»è¿›è¡Œæ‹©æ—¶
#   - è¶‹åŠ¿çº¿ï¼šæ ¹æ®èµ„é‡‘æ›²çº¿çš„è¶‹åŠ¿è¿›è¡Œæ‹©æ—¶
# å‚æ•°è¯´æ˜Žï¼š
#   - name: æ‹©æ—¶æ–¹æ³•åç§°
#   - params: æ‹©æ—¶æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œä¸åŒæ–¹æ³•å‚æ•°ä¸åŒ
#     ç§»åŠ¨å¹³å‡çº¿: [å‘¨æœŸ]
#     å¸ƒæž—å¸¦: [å‘¨æœŸ, æ ‡å‡†å·®å€æ•°]
#     è¶‹åŠ¿çº¿: [å‘¨æœŸ]
equity_timing = {"name": "ç§»åŠ¨å¹³å‡çº¿", "params": [20]}


# ====================================================================================================
# 4ï¸âƒ£ æ¨¡æ‹Ÿäº¤æ˜“é…ç½®
# ä»¥ä¸‹å‚æ•°å‡ ä¹Žä¸éœ€è¦æ”¹åŠ¨
# ====================================================================================================
initial_cash = 10_0000  # åˆå§‹èµ„é‡‘10w
# initial_cash = 1_0000_0000  # åˆå§‹èµ„é‡‘10w
# æ‰‹ç»­è´¹
c_rate = 1.2 / 10000
# å°èŠ±ç¨Ž
t_rate = 1 / 1000
# å¹¶è¡Œè¿è¡Œçš„è¿›ç¨‹æ•°
n_jobs = os.cpu_count() - 1

# =====å‚æ•°é¢„æ£€æŸ¥=====
if Path(stock_data_path).exists() is False:
    print(f"è‚¡ç¥¨æ—¥çº¿æ•°æ®è·¯å¾„ä¸å­˜åœ¨ï¼š{stock_data_path}ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–è”ç³»åŠ©æ•™ï¼Œç¨‹åºé€€å‡º")
    exit()
if Path(index_data_path).exists() is False:
    print(f"æŒ‡æ•°æ•°æ®è·¯å¾„ä¸å­˜åœ¨ï¼š{index_data_path}ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–è”ç³»åŠ©æ•™ï¼Œç¨‹åºé€€å‡º")
    exit()
